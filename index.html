import React, { useState } from 'react';

const LessonPlanGenerator = () => {
  const [formData, setFormData] = useState({
    subject: '',
    grade: '',
    topic: '',
    objectives: ''
  });
  const [loading, setLoading] = useState(false);
  const [generatedPlan, setGeneratedPlan] = useState('');

  const subjects = ['Қазақ тілі', 'Математика', 'Ағылшын тілі', 'Орыс тілі', 'Тарих', 'География', 'Биология', 'Физика', 'Химия', 'Информатика'];
  const grades = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11'];

  const handleChange = (e) => {
    setFormData({...formData, [e.target.name]: e.target.value});
  };

  const generatePlan = async () => {
    if (!formData.subject || !formData.grade || !formData.topic) {
      alert('Барлық өрістерді толтырыңыз!');
      return;
    }

    setLoading(true);
    try {
      const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer sk-proj-xxx' // Пайдаланушы өз API кілтін қояды
        },
        body: JSON.stringify({
          model: 'deepseek-chat',
          messages: [{
            role: 'user',
            content: `Қазақстан білім беру стандарттары бойынша қысқа мерзімді жоспар (ҚМЖ) құрастыр.

Пән: ${formData.subject}
Сынып: ${formData.grade}
Тақырып: ${formData.topic}
Оқу мақсаттары: ${formData.objectives || 'Пән бағдарламасы бойынша'}

ҚМЖ мына құрылымда бол:
1. Жалпы мәліметтер (мектеп, мұғалім, пән, сынып, күні)
2. Сабақтың тақырыбы
3. Оқу мақсаттары
4. Сабақ барысы (5 кезең):
   - Ұйымдастыру (5 мин)
   - Үй тапсырмасын тексеру (10 мин)
   - Жаңа тақырып (15 мин)
   - Бекіту (10 мин)
   - Қорытынды (5 мин)
5. Бағалау
6. Саралау
7. Ресурстар

Толық қазақ тілінде жаз.`
          }],
          temperature: 0.7
        })
      });

      const data = await response.json();
      if (data.choices && data.choices[0]) {
        setGeneratedPlan(data.choices[0].message.content);
      }
    } catch (error) {
      alert('Қате орын алды! API кілтіңізді тексеріңіз.');
      console.error(error);
    }
    setLoading(false);
  };

  const downloadPDF = () => {
    const win = window.open('', '_blank');
    win.document.write(`
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Сабақ жоспары</title>
        <style>
          body { font-family: Arial; padding: 30px; line-height: 1.6; }
          h1 { text-align: center; color: #333; }
          h2 { color: #0066cc; margin-top: 20px; }
          p { margin: 8px 0; }
        </style>
      </head>
      <body>
        <h1>ҚЫСҚА МЕРЗІМДІ ЖОСПАР</h1>
        <p><strong>Пән:</strong> ${formData.subject}</p>
        <p><strong>Сынып:</strong> ${formData.grade}</p>
        <p><strong>Күні:</strong> ${new Date().toLocaleDateString('kk-KZ')}</p>
        <hr>
        <pre style="white-space: pre-wrap; font-family: Arial;">${generatedPlan}</pre>
      </body>
      </html>
    `);
    win.document.close();
    setTimeout(() => win.print(), 500);
  };

  return (
    <div style={{maxWidth: '800px', margin: '0 auto', padding: '20px', fontFamily: 'Arial'}}>
      <h1 style={{textAlign: 'center', color: '#0066cc'}}>Сабақ жоспары генераторы</h1>
      <p style={{textAlign: 'center', color: '#666', marginBottom: '30px'}}>DeepSeek AI көмегімен</p>

      <div style={{background: '#f5f5f5', padding: '20px', borderRadius: '8px', marginBottom: '20px'}}>
        <div style={{marginBottom: '15px'}}>
          <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>Пән *</label>
          <select name="subject" value={formData.subject} onChange={handleChange} 
                  style={{width: '100%', padding: '10px', fontSize: '16px', borderRadius: '4px', border: '1px solid #ddd'}}>
            <option value="">Таңдаңыз</option>
            {subjects.map(s => <option key={s} value={s}>{s}</option>)}
          </select>
        </div>

        <div style={{marginBottom: '15px'}}>
          <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>Сынып *</label>
          <select name="grade" value={formData.grade} onChange={handleChange}
                  style={{width: '100%', padding: '10px', fontSize: '16px', borderRadius: '4px', border: '1px solid #ddd'}}>
            <option value="">Таңдаңыз</option>
            {grades.map(g => <option key={g} value={g}>{g} сынып</option>)}
          </select>
        </div>

        <div style={{marginBottom: '15px'}}>
          <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>Тақырып *</label>
          <input type="text" name="topic" value={formData.topic} onChange={handleChange}
                 placeholder="Сабақ тақырыбын жазыңыз"
                 style={{width: '100%', padding: '10px', fontSize: '16px', borderRadius: '4px', border: '1px solid #ddd'}} />
        </div>

        <div style={{marginBottom: '15px'}}>
          <label style={{display: 'block', marginBottom: '5px', fontWeight: 'bold'}}>Оқу мақсаттары</label>
          <textarea name="objectives" value={formData.objectives} onChange={handleChange}
                    placeholder="Мысалы: 5.1.1.1, 5.2.3.1"
                    rows="3"
                    style={{width: '100%', padding: '10px', fontSize: '16px', borderRadius: '4px', border: '1px solid #ddd'}} />
        </div>

        <button onClick={generatePlan} disabled={loading}
                style={{width: '100%', padding: '15px', fontSize: '18px', fontWeight: 'bold', 
                        background: loading ? '#ccc' : '#0066cc', color: 'white', border: 'none', 
                        borderRadius: '4px', cursor: loading ? 'not-allowed' : 'pointer'}}>
          {loading ? 'Құрастырылуда...' : 'Жоспар құрастыру'}
        </button>
      </div>

      {generatedPlan && (
        <div style={{background: 'white', padding: '20px', border: '1px solid #ddd', borderRadius: '8px'}}>
          <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px'}}>
            <h2 style={{margin: 0}}>Құрастырылған жоспар</h2>
            <button onClick={downloadPDF}
                    style={{padding: '10px 20px', background: '#28a745', color: 'white', 
                            border: 'none', borderRadius: '4px', cursor: 'pointer', fontWeight: 'bold'}}>
              PDF жүктеу
            </button>
          </div>
          <div style={{background: '#f9f9f9', padding: '15px', borderRadius: '4px', whiteSpace: 'pre-wrap'}}>
            {generatedPlan}
          </div>
        </div>
      )}

      <div style={{marginTop: '30px', padding: '15px', background: '#fff3cd', borderRadius: '4px', border: '1px solid #ffc107'}}>
        <p style={{margin: 0, fontSize: '14px'}}>
          <strong>Ескерту:</strong> DeepSeek API кілтін қолдану үшін кодта "sk-proj-xxx" орнына өз API кілтіңізді қойыңыз.
          <br/>API кілтін алу үшін: <a href="https://platform.deepseek.com" target="_blank">platform.deepseek.com</a>
        </p>
      </div>
    </div>
  );
};

export default LessonPlanGenerator;
